# Book Metrics Tools

This directory contains Python scripts for analyzing and generating metrics for intelligent textbooks built with MkDocs.

## Scripts

### book-metrics.py

Generates comprehensive metrics for intelligent textbooks, producing two reports:

- **book-metrics.md**: Overall statistics (chapters, concepts, glossary terms, FAQs, quiz questions, diagrams, equations, MicroSims, word counts, links)
- **chapter-metrics.md**: Per-chapter breakdown of metrics

**Usage:**

```bash
# From the textbook root directory
python /path/to/book-metrics.py docs

# Or specify a different docs directory
python /path/to/book-metrics.py /path/to/textbook/docs
```

**Output:**
- `docs/learning-graph/book-metrics.md`
- `docs/learning-graph/chapter-metrics.md`

### generate-equation-list.py

Generates a comprehensive list of all LaTeX equations in the textbook with links to their source locations. This report is useful for:

- Verifying that all equations render correctly
- Reviewing equation coverage across chapters
- Finding and fixing broken LaTeX syntax

**Usage:**

```bash
# From the textbook root directory (uses defaults)
python /path/to/generate-equation-list.py docs

# Specify custom output file
python /path/to/generate-equation-list.py docs docs/learning-graph/list-equations.md

# Or with full paths
python /path/to/generate-equation-list.py /path/to/textbook/docs /path/to/output.md
```

**Output:**
- `docs/learning-graph/list-equations.md` (default)

**Features:**
- Extracts both display (`$$...$$`) and inline (`$...$`) equations
- Groups equations by chapter
- Provides line numbers and clickable links to source
- Generates MkDocs-compatible relative links with `.md` extension for proper link resolution
- Renders equations in the report for visual verification
- Excludes administrative directories (prompts/, learning-graph/)

## Equation Detection

Both scripts use the same equation detection logic:

1. **Display math**: Matches `$$...$$` patterns (multiline supported)
2. **Inline math**: Matches `$...$` patterns
3. **Exclusions**:
   - Dollar amounts like `$500` are not counted as equations
   - Display math is removed before counting inline math to avoid double-counting

## Directory Structure

```
book-metrics/
├── README.md                    # This file
├── book-metrics.py              # Main metrics generator
├── generate-equation-list.py    # Equation list generator
├── EQUATION_COUNT_FIX.md        # Documentation of equation counting fix
└── equation-count-test.md       # Test file for equation counting
```

## Requirements

- Python 3.6+
- No external dependencies (uses only standard library)

## Example Output

### Equation List Report

The `generate-equation-list.py` script produces a report like:

```markdown
# Equation List

**Generated by**: Equation List Generator v1.0.0
**Generated on**: December 28, 2024 at 10:30 AM

## Summary

| Metric | Count |
|--------|-------|
| Total Equations | 245 |
| Display Equations | 87 |
| Inline Equations | 158 |

## Equations by Chapter

### Chapter 1: Scientific Foundations

*25 equations (10 display, 15 inline)*

| # | Type | Equation | Source |
|---|------|----------|--------|
| 1 | Display | $$F = ma$$ | [Line 42](../chapters/01-scientific-foundations/index.md) |
| 2 | Inline | $v = \frac{d}{t}$ | [Line 58](../chapters/01-scientific-foundations/index.md) |
...
```

## Integration with MkDocs

Add the generated reports to your `mkdocs.yml` navigation:

```yaml
nav:
  - Learning Graph:
    - Book Metrics: learning-graph/book-metrics.md
    - Chapter Metrics: learning-graph/chapter-metrics.md
    - Equation List: learning-graph/list-equations.md
```

## Troubleshooting

### Equations not detected

- Ensure equations use proper LaTeX delimiters: `$...$` or `$$...$$`
- Check for unbalanced delimiters
- Inline equations must not start with a digit after the `$` (to avoid matching dollar amounts)

### Report shows wrong chapter

- Chapter detection relies on directory naming convention: `XX-chapter-name/`
- Files outside the `chapters/` directory are grouped under "Other Content"
